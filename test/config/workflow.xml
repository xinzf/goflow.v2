<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE workflow SYSTEM "goflow.dtd" >
<workflow id="bldz-20190516" version="1" describe="不良垫资" name="不良垫资">
    <steps start="1" end="16" start-init-status="created">
        <step id="1" name="初录">
            <actions>
                <action name="draft" text="暂存">
                    <results>
                        <default-result step="-1" status="draft">
                            <owners>
                                <owner type="caller" />
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="submit" text="提交">
                    <pre-functions>
                        <function name="copyTo">
                            <arg name="users">17,18,19</arg>
                        </function>
                    </pre-functions>
                    <results>
                        <default-result step="2" status="queue" exit-status="done" due-seconds="7200">
                            <owners>
                                <owner type="leader"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
            </actions>
        </step>
        <step id="2" name="初价">
            <actions>
                <!--<restrict message="当前状态不允许次操作或无权操作">-->
                    <!--<conditions type="AND">-->
                        <!--<function name="matchState" want="true">-->
                            <!--<arg name="step_id">${curr_step_id}</arg>-->
                            <!--<arg name="state">doing</arg>-->
                        <!--</function>-->
                    <!--</conditions>-->
                <!--</restrict>-->

                <action name="rollback" text="回退">
                    <results>
                        <default-result step="1" exit-status="done" status="supplement">
                            <owners>
                                <owner type="creator"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="reject" text="拒绝">
                    <results>
                        <default-result status="done" step="-2" />
                    </results>
                </action>
                <action name="success" text="报初价">
                    <results>
                        <default-result split="1" exit-status="done" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="3" name="详录">
            <actions>
                <restrict message="当前状态不可进行此操作">
                    <conditions>
                        <function name="matchState" want="true">
                            <arg name="step_id">${curr_step_id}</arg>
                            <arg name="state">doing</arg>
                        </function>
                    </conditions>
                </restrict>

                <action name="draft" text="暂存">
                    <results>
                        <default-result step="-1" />
                    </results>
                </action>
                <action name="submit" text="提交">
                    <results>
                        <default-result join="1" exit-status="done" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="4" name="面签">
            <actions>
                <action name="dead" text="未成交">
                    <results>
                        <default-result exit-status="done" step="-2" />
                    </results>
                </action>
                <action name="deal" text="成交">
                    <results>
                        <default-result join="1" exit-status="done" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="5" name="自动拆分审核">
            <actions>
                <action name="auto" text="auto_1" auto="true">
                    <results>
                        <default-result split="2" exit-status="done" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="6" name="风险审核">
            <actions>
                <restrict>
                    <conditions>
                        <function name="matchState">
                            <arg name="step_id">${curr_step_id}</arg>
                            <arg name="state">doing</arg>
                        </function>
                    </conditions>
                </restrict>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="supplement">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="reject" text="拒绝">
                    <results>
                        <default-result exit-status="done" status="-2" />
                    </results>
                </action>
                <action name="success" text="通过">
                    <results>
                        <default-result exit-status="done" join="2" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="7" name="财务审核">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="supplement">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="reject" text="拒绝">
                    <results>
                        <default-result exit-status="done" status="-2" />
                    </results>
                </action>
                <action name="success" text="通过">
                    <results>
                        <default-result exit-status="done" join="2" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="8" name="经理审批">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="supplement">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="reject" text="拒绝">
                    <results>
                        <default-result exit-status="done" status="-2"/>
                    </results>
                </action>
                <action name="success" text="通过">
                    <results>
                        <default-result exit-status="done" step="9" status="queue">
                            <owners>
                                <owner type="users" props="100"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
            </actions>
        </step>
        <step id="9" name="权证进件">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="queue">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="assignment" text="指派专员">
                    <results>
                        <default-result exit-status="done" split="3" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="10" name="开卡">
            <actions>
                <action name="success" text="开卡完成">
                    <results>
                        <default-result exit-status="done" step="12" status="queue">
                            <owners>
                                <owner type="users" props="18"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
            </actions>
        </step>
        <step id="11" name="贷款审批">
            <actions>
                <action name="rollback" text="贷款未通过">
                    <results>
                        <default-result exit-status="done" step="9" status="supplement">
                            <owners>
                                <owner type="users" props="100"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="success" text="贷款通过">
                    <results>
                        <default-result exit-status="done" join="3" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="12" name="控卡">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result status="queue" step="${rollback_id}" exit-status="done">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="success" text="确认卡盾安全">
                    <results>
                        <default-result exit-status="done" join="3" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="13" name="再风控">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="queue">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="reject" text="拒绝">
                    <results>
                        <default-result exit-status="done" status="-2" />
                    </results>
                </action>
                <action name="success" text="通过">
                    <results>
                        <default-result exit-status="done" step="14" status="queue">
                            <owners>
                                <owner type="users" props="18"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
            </actions>
        </step>
        <step id="14" name="利息前置">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="queue">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="success" text="完成">
                    <results>
                        <default-result exit-status="done" step="15" status="queue">
                            <owners>
                                <owner type="users" props="17"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
            </actions>
        </step>
        <step id="15" name="放款解押过户">
            <actions>
                <action name="success" text="完成">
                    <results>
                        <default-result exit-status="done" step="16" status="queue">
                            <owners>
                                <owner type="users" props="18"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
            </actions>
        </step>
        <step id="16" name="结清">
            <actions>
                <action name="rollback" text="回退">
                    <results>
                        <default-result exit-status="done" step="${rollback_id}" status="queue">
                            <owners>
                                <owner type="variable" props="${rollback_uid}"/>
                            </owners>
                        </default-result>
                    </results>
                </action>
                <action name="success" text="已结清">
                    <results>
                        <default-result exit-status="done" />
                    </results>
                </action>
            </actions>
        </step>
        <step id="17" name="结案" />
    </steps>

    <splits>
        <split id="1">
            <results>
                <default-result status="queue" due-seconds="7200" step="3">
                    <owners>
                        <owner type="creator"/>
                    </owners>
                </default-result>
                <default-result step="4" status="queue">
                    <owners>
                        <owner type="caller"/>
                    </owners>
                </default-result>
            </results>
        </split>
        <split id="2">
            <results>
                <default-result status="queue" due-seconds="7200" step="6">
                    <owners>
                        <owner type="users" props="17"/>
                    </owners>
                </default-result>
                <default-result status="queue" step="7">
                    <owners>
                        <owner type="users" props="18"/>
                    </owners>
                </default-result>
            </results>
        </split>
        <split id="3">
            <results>
                <default-result status="queue" step="10">
                    <owners>
                        <owner type="variable" props="${task_uid}"/>
                    </owners>
                </default-result>
                <default-result status="queue" step="11">
                    <owners>
                        <owner type="variable" props="${task_uid}"/>
                    </owners>
                </default-result>
            </results>
        </split>
    </splits>

    <joins>
        <join id="1">
            <results>
                <result step="5" status="queue">
                    <conditions type="AND">
                        <function name="canJoin" want="true">
                            <arg name="step_id">3</arg>
                            <arg name="state">done</arg>
                            <arg name="action">submit</arg>
                        </function>
                        <function name="canJoin" want="true">
                            <arg name="step_id">4</arg>
                            <arg name="state">done</arg>
                            <arg name="action">deal</arg>
                        </function>
                    </conditions>
                </result>
            </results>
        </join>
        <join id="2">
            <results>
                <result step="8" status="queue" due-seconds="7200">
                    <conditions>
                        <function name="canJoin" want="true">
                            <arg name="step_id">6</arg>
                            <arg name="state">done</arg>
                            <arg name="action">success</arg>
                        </function>
                        <function name="canJoin" want="true">
                            <arg name="step_id">7</arg>
                            <arg name="state">done</arg>
                            <arg name="action">success</arg>
                        </function>
                    </conditions>
                    <owners>
                        <owner type="users" props="16"/>
                    </owners>
                </result>
            </results>
        </join>
        <join id="3">
            <results>
                <default-result step="13" status="queue">
                    <conditions type="AND">
                        <function name="canJoin" want="true">
                            <arg name="step_id">11</arg>
                            <arg name="state">done</arg>
                            <arg name="action">success</arg>
                        </function>
                        <function name="canJoin" want="true">
                            <arg name="step_id">12</arg>
                            <arg name="state">done</arg>
                            <arg name="action">success</arg>
                        </function>
                    </conditions>
                    <owners>
                        <owner type="users" props="17"/>
                    </owners>
                </default-result>
            </results>
        </join>
    </joins>
</workflow>

